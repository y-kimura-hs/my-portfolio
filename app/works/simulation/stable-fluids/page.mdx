{/*
---
title: "Realtime Stable Fluids"
date: "2023-12-10"
year: "2023"
category: "Simulation"
tags: ["WebGL", "Physics", "GLSL"]
description: "WebGL 2.0を用いたリアルタイム流体シミュレーション。Navier-Stokes方程式をGPU上で解き、煙のような挙動を再現しています。"
color: "from-blue-600 to-cyan-400"
---
*/}

import PageLayout from '@/components/layout/PageLayout'
import ViewCanvas from '@/components/canvas/ViewCanvas'
import Box from '@/components/canvas/Box'
import Particles from '@/components/canvas/Particles'
import Link from 'next/link'

<PageLayout 
  title="Realtime Stable Fluids" 
  description="WebGL 2.0 / GLSL / Physics Simulation"
>

{/* --- デモセクション --- */}
<ViewCanvas>
  <Particles />
  <Box position={[0, 0, 0]} />
</ViewCanvas>


{/* --- 解説セクション --- */}
<div className="grid grid-cols-1 lg:grid-cols-[1fr_250px] gap-12 mt-12">
  
  <article>
    ## プロジェクト概要
    
    Jos Stam氏が1999年に発表した "Stable Fluids" アルゴリズムを、WebGL 2.0 (GPGPU) を用いてブラウザ上に実装しました。
    ナビエ・ストークス方程式を構成する「移流」「拡散」「外力」「圧力計算（発散除去）」の各項を、フラグメントシェーダーによるピングポンレンダリングで解いています。

    ### 技術的なポイント
    
    1. **Jacobi法による圧力計算**: 
       圧力場のポアソン方程式を解くために、反復法であるJacobi法を採用。フラグメントシェーダーで数十回反復させることで、非圧縮性流体の挙動を近似しています。
    
    2. **MacCormack法による移流**:
       単純なセミラグランジュ法では数値拡散によりディテールが失われやすいため、MacCormack法を導入して渦のディテールを維持しています。

    ### 実装コード（抜粋）
    
    移流項のシェーダーコードです。

    ```glsl
    uniform sampler2D velocity;
    uniform sampler2D source;
    uniform float dt;

    void main() {
        vec2 coord = gl_FragCoord.xy;
        // 速度場に従ってバックトレース
        vec2 pos = coord - dt * texture(velocity, uv).xy;
        // 補間して値をサンプリング
        gl_FragColor = texture(source, pos / resolution);
    }
    ```
  </article>

  <aside className="space-y-8">
    <div className="bg-white/5 p-6 rounded-xl border border-border">
      <h3 className="font-bold text-white mb-4">Tech Stack</h3>
      <ul className="space-y-2 text-sm text-gray-300">
        <li className="flex items-center"><span className="w-2 h-2 bg-blue-500 rounded-full mr-2"></span>Three.js</li>
        <li className="flex items-center"><span className="w-2 h-2 bg-purple-500 rounded-full mr-2"></span>GLSL</li>
        <li className="flex items-center"><span className="w-2 h-2 bg-green-500 rounded-full mr-2"></span>React Three Fiber</li>
      </ul>
    </div>
    
    <div className="bg-white/5 p-6 rounded-xl border border-border">
      <h3 className="font-bold text-white mb-4">Links</h3>
      <a href="#" className="block text-primary hover:underline text-sm mb-2">View on GitHub ↗</a>
      <a href="#" className="block text-primary hover:underline text-sm">Paper Reference ↗</a>
    </div>
  </aside>

</div>

{/* --- ページ下部ナビゲーション --- */}
<hr className="border-border my-12" />

<div className="flex flex-col md:flex-row justify-between items-center gap-6">
  
  {/* 前の記事 */}
  <Link href="#" className="group flex items-center gap-4 text-left w-full md:w-auto p-4 rounded-lg hover:bg-white/5 transition-colors border border-transparent hover:border-border">
    <div className="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center group-hover:bg-primary/20 group-hover:text-primary transition-colors">
      ←
    </div>
    <div>
      <div className="text-xs text-txt-muted">Previous Work</div>
      <div className="font-bold text-white group-hover:text-primary">Volumetric Lighting</div>
    </div>
  </Link>

  {/* 一覧に戻るボタン */}
  <Link href="/works" className="px-6 py-2 rounded-full border border-border text-sm text-txt-muted hover:bg-white/10 hover:text-white transition-colors">
    Back to Works
  </Link>

  {/* 次の記事 */}
  <Link href="#" className="group flex items-center gap-4 text-right w-full md:w-auto justify-end p-4 rounded-lg hover:bg-white/5 transition-colors border border-transparent hover:border-border">
    <div>
      <div className="text-xs text-txt-muted">Next Work</div>
      <div className="font-bold text-white group-hover:text-primary">Mandelbulb Raymarching</div>
    </div>
    <div className="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center group-hover:bg-primary/20 group-hover:text-primary transition-colors">
      →
    </div>
  </Link>

</div>

</PageLayout>